(this["webpackJsonpsolitaire-rl-web"]=this["webpackJsonpsolitaire-rl-web"]||[]).push([[0],{387:function(e){e.exports=JSON.parse('{"a":"0.0.32"}')},400:function(e,t,n){},401:function(e,t,n){},411:function(e,t){},412:function(e,t){},420:function(e,t){},423:function(e,t){},424:function(e,t){},425:function(e,t,n){},430:function(e,t,n){},431:function(e,t,n){},507:function(e,t,n){},508:function(e,t,n){},509:function(e,t,n){},511:function(e,t,n){"use strict";n.r(t);var r=n(22),a=n(21),c=n.n(a),i=n(153),o=n.n(i),s=(n(399),n(400),n(154)),u=n(58),l="/",b="/manual-play",d="/agent-play",j="/training",f=(n(401),function(){return Object(r.jsx)("div",{className:"navigation",children:Object(r.jsxs)("ul",{children:[Object(r.jsx)("li",{children:Object(r.jsx)(s.b,{to:b,activeClassName:"navigation-link--active",children:"Manual Play"})}),Object(r.jsx)("li",{children:Object(r.jsx)(s.b,{to:d,activeClassName:"navigation-link--active",children:"Agent Play"})}),Object(r.jsx)("li",{children:Object(r.jsx)(s.b,{to:j,activeClassName:"navigation-link--active",children:"Training"})})]})})}),h=n(5),v=n(104),O=n(302),p=n(26),x=n(25),m=n(12),g=n(13),k=n(1),y=n(8),w=n(7),_=n(273),N=n(2),S=n.n(N),A=n(15),M=n(67),C=N.mark(X),L=function(e){return Array.from(Array(e).keys())};function X(e){var t;return N.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=0;case 1:if(!(t<e)){n.next=7;break}return n.next=4,t;case 4:t++,n.next=1;break;case 7:case"end":return n.stop()}}),C)}var I=function(e){return e[0]},R=function(e){var t=e.length;return e.reduce((function(e,t){return e+t}),0)/t},F=function(e){var t=e/1e3,n=Math.floor(t/60).toString().padStart(2,"0"),r=Math.floor(t%60).toString().padStart(2,"0");return"".concat(n,":").concat(r)},E=function(e){return e[Math.floor(Math.random()*e.length)]},B=N.mark(U),T=N.mark(P),z=[0,1,2,3],J=function(){function e(t,n){var r=this;Object(k.a)(this,e),this.sameAs=function(e){return r.key===e.key},this._row=t,this._col=n,this._key="".concat(t,":").concat(n)}return Object(y.a)(e,[{key:"row",get:function(){return this._row}},{key:"col",get:function(){return this._col}},{key:"key",get:function(){return this._key}}]),e}();J.fromKey=function(e){var t=e.split(":").map(Number),n=Object(h.a)(t,2),r=n[0],a=n[1];return new J(r,a)};var V=function(){function e(t,n,r){Object(k.a)(this,e),this._fromLocation=t,this._viaLocation=n,this._toLocation=r}return Object(y.a)(e,[{key:"fromLocation",get:function(){return this._fromLocation}},{key:"viaLocation",get:function(){return this._viaLocation}},{key:"toLocation",get:function(){return this._toLocation}}]),e}(),G=function(e,t){var n=e.row,r=e.col;switch(t){case 0:return new J(n-1,r);case 1:return new J(n+1,r);case 2:return new J(n,r-1);case 3:return new J(n,r+1);default:throw new Error("Unknown direction ".concat(t))}};function U(){var e,t,n,r,a,c,i,o,s;return N.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:t=(e=["  XXX  ","  XXX  ","XXXXXXX","XXXXXXX","XXXXXXX","  XXX  ","  XXX  "]).length,n=e[0].length,r=Object(w.a)(X(t)),u.prev=4,r.s();case 6:if((a=r.n()).done){u.next=28;break}c=a.value,i=Object(w.a)(X(n)),u.prev=9,i.s();case 11:if((o=i.n()).done){u.next=18;break}if(s=o.value,"X"!==e[c][s]){u.next=16;break}return u.next=16,new J(c,s);case 16:u.next=11;break;case 18:u.next=23;break;case 20:u.prev=20,u.t0=u.catch(9),i.e(u.t0);case 23:return u.prev=23,i.f(),u.finish(23);case 26:u.next=6;break;case 28:u.next=33;break;case 30:u.prev=30,u.t1=u.catch(4),r.e(u.t1);case 33:return u.prev=33,r.f(),u.finish(33);case 36:case"end":return u.stop()}}),B,null,[[4,30,33,36],[9,20,23,26]])}function P(){var e,t,n,r,a,c,i,o;return N.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:e=0,t=D;case 1:if(!(e<t.length)){s.next=17;break}n=t[e],r=0,a=z;case 4:if(!(r<a.length)){s.next=14;break}if(c=a[r],i=G(n,c),o=G(i,c),!q.has(i.key)||!q.has(o.key)){s.next=11;break}return s.next=11,new V(n,i,o);case 11:r++,s.next=4;break;case 14:e++,s.next=1;break;case 17:case"end":return s.stop()}}),T)}var Y=new J(3,3),D=Array.from(U()),q=new Map(D.map((function(e){return[e.key,e]}))),H=Array.from(P()),K=function(){function e(t){var n=this;Object(k.a)(this,e),this.location=function(e){return n._boardState.get(e.key)},this._boardState=t?new Map(t):new Map(D.map((function(e){return[e.key,!e.sameAs(Y)]})))}return Object(y.a)(e,[{key:"validActions",value:function(){var e=this;return L(H.length).filter((function(t){return e.isValidAction(t)}))}},{key:"isValidAction",value:function(e){var t=H[e],n=t.fromLocation,r=t.viaLocation,a=t.toLocation;return this._boardState.get(n.key)&&this._boardState.get(r.key)&&!this._boardState.get(a.key)}},{key:"makeMove",value:function(t){var n=H[t],r=n.fromLocation,a=n.viaLocation,c=n.toLocation,i=new Map(this._boardState);return i.set(r.key,!1),i.set(a.key,!1),i.set(c.key,!0),new e(i)}},{key:"undoMove",value:function(t){var n=H[t],r=n.fromLocation,a=n.viaLocation,c=n.toLocation,i=new Map(this._boardState);return i.set(r.key,!0),i.set(a.key,!0),i.set(c.key,!1),new e(i)}},{key:"entries",value:function(){return Array.from(this._boardState.entries()).map((function(e){var t=Object(h.a)(e,2),n=t[0],r=t[1];return[q.get(n),r]}))}},{key:"done",get:function(){return 0===this.validActions().length}},{key:"solved",get:function(){return 1===Array.from(this._boardState.values()).filter((function(e){return e})).length&&this.location(Y)}}]),e}(),Q=function(e){var t=new Map(D.map((function(t,n){return[t.key,Boolean(e[n])]})));return new K(t)},W=function(e){return D.map((function(t){return Number(e.location(t))}))},Z={},$=function(){function e(){var t=this;Object(k.a)(this,e),this.reset=function(){return t._board=new K,W(t._board)},this.step=function(e){if(t._board.done)return[W(t._board),0,!0,Z];if(!t._board.isValidAction(e))return[W(t._board),-100,!1,Z];t._board=t._board.makeMove(e);var n=W(t._board),r=t._board.done;return[n,r?t._calculateFinalReward():0,r,Z]},this.undo=function(e){return t._board=t._board.undoMove(e),W(t._board)},this.render=function(){var e,n=Object(w.a)(X(7));try{for(n.s();!(e=n.n()).done;){var r,a=e.value,c="",i=Object(w.a)(X(7));try{for(i.s();!(r=i.n()).done;){var o=r.value,s=new J(a,o);q.has(s.key)?c+=t._board.location(s)?"X":".":c+=" "}}catch(u){i.e(u)}finally{i.f()}console.log(c)}}catch(u){n.e(u)}finally{n.f()}},this._calculateFinalReward=function(){var e,n=0,r=Object(w.a)(t._board.entries());try{for(r.s();!(e=r.n()).done;){var a=Object(h.a)(e.value,2),c=a[0];if(a[1]){var i=c.row,o=c.col;n-=Math.abs(i-Y.row)+Math.abs(o-Y.col)}}}catch(s){r.e(s)}finally{r.f()}return n},this._board=new K}return Object(y.a)(e,[{key:"validActions",value:function(){return this._board.validActions()}},{key:"entries",value:function(){return this._board.entries()}},{key:"done",get:function(){return this._board.done}},{key:"solved",get:function(){return this._board.solved}}]),e}();(function(){var e=Object(A.a)(N.mark((function e(){return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.ready();case 2:return e.next=4,M.setBackend("cpu");case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()();var ee=function(){var e=M.initializers.randomUniform({minval:-.5,maxval:.5}),t=M.sequential();t.add(M.layers.dense({inputShape:[33],units:10,activation:"tanh",name:"input-layer",kernelInitializer:e})),t.add(M.layers.dense({units:1,name:"output-layer",kernelInitializer:e}));var n=[];return t.summary(void 0,void 0,(function(e){return n.push(e)})),console.log(n.join("\n")),t},te=function(e,t,n){var r=(t-e)/n;return function(a){return a>n?t:e+r*a}},ne=function(e,t){return M.tidy((function(){var n=Q(t),r=n.validActions(),a=r.map((function(e){var t=n.makeMove(e);return W(t)}));return function(e,t){var n=Math.min(e.length,t.length);return L(n).map((function(n){return[e[n],t[n]]}))}(e.predict(M.tensor(a)).dataSync(),r)}))},re=function(e,t){var n=Object(_.a)(e),r=n[0];return n.slice(1).reduce((function(e,n){return t(n)>t(e)?n:e}),r)},ae=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=ne(e,t);return Math.random()<n?E(r):re(r,I)}},ce=function(e,t,n){switch(e){case"endCondition0":return n.solved;case"endCondition1":default:return n.solved&&function(e){for(var t=[],n=be(e);!n.done;){var r=n.step().actionIndex;t.push(r)}var a=n.solved;return console.log("[checkEndCondition1] actions (".concat(t.length,"): ").concat(JSON.stringify(t),"; solved: ").concat(a)),a}(t);case"endCondition2":return n.solved&&function(e){return console.log("[checkEndCondition2] ".concat("-".repeat(20)," START ").concat("-".repeat(20))),(new K).validActions().every((function(t){for(var n=[],r=be(e,{initialAction:t});!r.done;){var a=r.step().actionIndex;n.push(a)}var c=r.solved;return console.log("[checkEndCondition2] actions (".concat(n.length,"): ").concat(JSON.stringify(n),"; solved: ").concat(c)),c}))}(t)}},ie=function(){var e=Object(A.a)(N.mark((function e(t,n,r,a,c){var i,o,s,u,l,b,d,j,f,v,O,p,x,m;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=M.train.sgd(.001),o=M.losses.meanSquaredError,s=[],u=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY,b=te(.5,.01,5e3),d=Object(w.a)(X(1e4)),e.prev=7,d.s();case 9:if((j=d.n()).done){e.next=25;break}f=j.value,v=b(f),O=t.reset(),p=[],x=N.mark((function e(){var b,d,j,x,m,g,k,y,w,_,S,A,C,L;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b=r(O,v),d=Object(h.a)(b,2),j=d[0],x=d[1],p.push(x),m=t.step(x),g=Object(h.a)(m,3),k=g[0],y=g[1],w=g[2],_=y+1*(1-w)*j,S=O,i.minimize((function(){return M.tidy((function(){var e=M.tensor(S).expandDims(0),t=n.apply(e).squeeze(-1),r=M.tensor(_).expandDims(0);return o(t,r)}))})),O=k,!w){e.next=24;break}if(A=y,s.push(A),A>u&&(u=A),C=Number.NEGATIVE_INFINITY,s.length>=100&&(C=R(s.slice(-100)))>l&&(l=C),L={episode:f+1,epsilon:v,finalReward:A,bestFinalReward:u,finalRewardMA:C,bestFinalRewardMA:l,actions:p},c.progress(L),!ce(a,n,t)){e.next=18;break}return i.dispose(),e.abrupt("return",{v:c.trainingSuccess(n,p)});case 18:if(!c.checkCancelled()){e.next=21;break}return i.dispose(),e.abrupt("return",{v:void 0});case 21:return e.next=23,M.nextFrame();case 23:return e.abrupt("return","break");case 24:case"end":return e.stop()}}),e)}));case 15:return e.delegateYield(x(),"t0",16);case 16:if("break"!==(m=e.t0)){e.next=19;break}return e.abrupt("break",23);case 19:if("object"!==typeof m){e.next=21;break}return e.abrupt("return",m.v);case 21:e.next=15;break;case 23:e.next=9;break;case 25:e.next=30;break;case 27:e.prev=27,e.t1=e.catch(7),d.e(e.t1);case 30:return e.prev=30,d.f(),e.finish(30);case 33:c.trainingFailure(n),i.dispose();case 35:case"end":return e.stop()}}),e,null,[[7,27,30,33]])})));return function(t,n,r,a,c){return e.apply(this,arguments)}}(),oe=function(){function e(){Object(k.a)(this,e),this._env=new $,this._state=this._env.reset()}return Object(y.a)(e,[{key:"reset",value:function(){return this._state=this._env.reset(),this._state}},{key:"step",value:function(){if(this.done)throw new Error("This episode is done - call reset to go again");var e=this.chooseAction(),t=H[e],n=this._env.step(e),r=Object(h.a)(n,3),a=r[0],c=r[1],i=r[2];return this._state=a,{state:a,reward:c,done:i,entries:this._env.entries(),action:t,actionIndex:e}}},{key:"chooseAction",value:function(){throw new Error("Derived classes must override BaseAgent#chooseAction")}},{key:"entries",value:function(){return this._env.entries()}},{key:"done",get:function(){return this._env.done}},{key:"solved",get:function(){return this._env.solved}}]),e}(),se=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(){return Object(k.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"chooseAction",value:function(){var e=Q(this._state).validActions();return E(e)}}]),n}(oe),ue=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e){var r;return Object(k.a)(this,n),(r=t.call(this))._actions=e,r._index=0,r}return Object(y.a)(n,[{key:"chooseAction",value:function(){return this._actions[this._index++]}},{key:"reset",value:function(){Object(p.a)(Object(x.a)(n.prototype),"reset",this).call(this),this._index=0}}]),n}(oe),le=function(e){Object(m.a)(n,e);var t=Object(g.a)(n);function n(e,r){var a;return Object(k.a)(this,n),(a=t.call(this))._options=r||{},a._isInitialMove=!0,a._pi=ae(e),a}return Object(y.a)(n,[{key:"chooseAction",value:function(){if(this._isInitialMove&&void 0!==this._options.initialAction){var e=this._options.initialAction;return this._isInitialMove=!1,e}var t=this._pi(this._state),n=Object(h.a)(t,2)[1];return this._isInitialMove=!1,n}},{key:"reset",value:function(){Object(p.a)(Object(x.a)(n.prototype),"reset",this).call(this),this._isInitialMove=!0}}]),n}(oe),be=function(e,t){return new le(e,t)},de=function(){var e=Object(A.a)(N.mark((function e(t,n){var r;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.loadLayersModel(t);case 2:return r=e.sent,e.abrupt("return",be(r,n));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),je=function(){var e=Object(A.a)(N.mark((function e(t,n){var r,a,c;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(JSON.stringify(M.memory())),r=new $,a=ee(),c=ae(a),e.next=6,ie(r,a,c,t,n);case 6:a.dispose(),console.log(JSON.stringify(M.memory()));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),fe=(n(425),12.5),he=12.5,ve=Math.min(fe,he)/4,Oe=Math.min(fe,he)/1.5,pe=Math.min(fe,he)/2.15,xe=function(e){return[e.key,60*Math.random()-30]},me=function(){return new Map(D.map(xe))},ge=function(e){return"rotate(".concat(e,"deg)")},ke=function(e,t){return"".concat(e,"% ").concat(t,"%")},ye=function(e){var t=e.resetBoard,n=e.entries,c=e.action,i=e.undo,o=e.interactive,s=e.validateManualMove,u=e.makeManualMove,l=Object(a.useState)((function(){return me()})),b=Object(h.a)(l,2),d=b[0],j=b[1],f=Object(a.useState)(!1),p=Object(h.a)(f,2),x=p[0],m=p[1],g=Object(a.useState)(null),k=Object(h.a)(g,2),y=k[0],w=k[1],_=Object(a.useState)(null),N=Object(h.a)(_,2),S=N[0],A=N[1],M=Object(a.useState)([]),C=Object(h.a)(M,2),L=C[0],X=C[1];Object(a.useEffect)((function(){t&&j(me())}),[n,t]),Object(a.useEffect)((function(){m(Boolean(c)),w(null),A(null),X([])}),[c,i]);var I=function(e){return function(){if(o&&L.find((function(t){return t.sameAs(e)}))){var t=s({fromLocation:y,toLocation:e});1===t.length&&u(t[0])}}},R=function(e){return function(){o&&L.find((function(t){return t.sameAs(e)}))&&A(e)}},F=function(){o&&A(null)},E=function(e){return function(){if(o)if(y&&y.sameAs(e))w(null),X([]);else{var t=s({fromLocation:e});t.length?(w(e),X(t.map((function(e){return H[e].toLocation})))):(w(null),X([]))}}},B=function(e){return[fe+fe*e.col,he+he*e.row]},T=function(e){var t=B(e),n=Object(h.a)(t,2),a=n[0],c=n[1],i=d.get(e.key),o={key:e.key,cx:a,cy:c,r:Oe,className:"board-marble",onClick:E(e)},s={transform:ge(i),transformOrigin:ke(a,c)};return Object(r.jsx)("circle",Object(v.a)(Object(v.a)({},o),{},{style:s}))},z=function(e,t){var n=B(e),a=Object(h.a)(n,2),c=a[0],i=a[1],o=B(t),s=Object(h.a)(o,2),u=s[0],l=s[1],b=d.get(e.key),j=d.get(t.key),f={cx:c,cy:i,r:Oe,className:"board-marble",onClick:E(t)};return Object(r.jsx)(O.Spring,{config:{duration:600},from:{cx:c,cy:i,transform:ge(b),transformOrigin:ke(c,i)},to:{cx:u,cy:l,transform:ge(j),transformOrigin:ke(u,l)},children:function(e){return Object(r.jsx)("circle",Object(v.a)(Object(v.a)({},f),{},{style:e}))}},t.key)};return Object(r.jsx)("div",{children:Object(r.jsxs)("svg",{className:"board",viewBox:"0 0 100 100",children:[Object(r.jsxs)("defs",{children:[Object(r.jsx)("pattern",{id:"board",height:"100%",width:"100%",patternContentUnits:"objectBoundingBox",children:Object(r.jsx)("image",{href:"images/board.jpeg",preserveAspectRatio:"none",width:"1",height:"1"})}),Object(r.jsx)("pattern",{id:"marble",height:"100%",width:"100%",patternContentUnits:"objectBoundingBox",children:Object(r.jsx)("image",{href:"images/marble.png",preserveAspectRatio:"none",width:"1",height:"1"})})]}),Object(r.jsx)("rect",{className:"board-background"}),D.map((function(e){var t=B(e),n=Object(h.a)(t,2),a=n[0],c=n[1],i=["board-hole"];L.find((function(t){return t.sameAs(e)}))&&i.push("board-hole--available"),S&&S.sameAs(e)&&i.push("board-hole--selected");var o={key:"hole-".concat(e.key),cx:a,cy:c,r:ve,className:i.join(" "),onClick:I(e),onMouseOver:R(e),onMouseOut:F};return Object(r.jsx)("circle",Object(v.a)({},o))})),function(){if(!c)return null;if(!i&&!x)return null;var e=c.viaLocation,t=B(e),n=Object(h.a)(t,2),a=n[0],o=n[1],s=d.get(e.key),u=i?{onClick:E(e)}:void 0,l=Object(v.a)({cx:a,cy:o,r:Oe,className:"board-marble"},u),b={transform:ge(s),transformOrigin:ke(a,o)};return Object(r.jsx)(O.Spring,{config:{duration:300,delay:300},from:{opacity:i?0:1},to:{opacity:i?1:0},onRest:function(){return m(!1)},children:function(e){return Object(r.jsx)("circle",Object(v.a)(Object(v.a)({},l),{},{style:Object(v.a)(Object(v.a)({},b),e)}))}},e.key)}(),n.filter((function(e){return Object(h.a)(e,2)[1]})).map((function(e){var t=Object(h.a)(e,1)[0];if(c){var n=i?c.toLocation:c.fromLocation,r=i?c.fromLocation:c.toLocation;if(t.sameAs(r))return z(n,r);if(i&&t.sameAs(c.viaLocation))return null}return T(t)})),function(){if(!y)return null;var e=B(y),t=Object(h.a)(e,2),n={cx:t[0],cy:t[1],r:pe,className:"board-marble-highlight"};return Object(r.jsx)("circle",Object(v.a)({},n))}()]})})},we=(n(430),function(){var e=Object(a.useState)((function(){return new $})),t=Object(h.a)(e,1)[0],n=Object(a.useState)(!0),c=Object(h.a)(n,2),i=c[0],o=c[1],s=Object(a.useState)([]),u=Object(h.a)(s,2),l=u[0],b=u[1],d=Object(a.useState)(null),j=Object(h.a)(d,2),f=j[0],v=j[1],O=Object(a.useState)(!1),p=Object(h.a)(O,2),x=p[0],m=p[1],g=Object(a.useState)([]),k=Object(h.a)(g,2),y=k[0],w=k[1],_=Object(a.useState)(null),N=Object(h.a)(_,2),S=N[0],A=N[1],M=Object(a.useCallback)((function(){t.reset(),o(!0),b(t.entries()),v(null),m(!1),w([]),A(null)}),[t]);Object(a.useEffect)(M,[M]);return Object(r.jsx)("div",{className:"agent-play-content",children:Object(r.jsxs)("div",{className:"board-wrapper",children:[Object(r.jsx)(ye,{resetBoard:i,entries:l,action:f,undo:x,interactive:!0,validateManualMove:function(e){var n=e.fromLocation,r=e.toLocation;return t.validActions().filter((function(e){var t=H[e],a=!n||t.fromLocation.sameAs(n),c=!r||t.toLocation.sameAs(r);return a&&c}))},makeManualMove:function(e){var n=t.step(e),r=Object(h.a)(n,3),a=r[1],c=r[2];o(!1),b(t.entries()),v(H[e]),m(!1),w((function(t){return t.concat(e)})),c&&A(a)}}),Object(r.jsxs)("div",{className:"board-controls-below",children:[Object(r.jsxs)("div",{children:[Object(r.jsx)("button",{type:"button",onClick:M,children:"Reset"}),Object(r.jsx)("button",{type:"button",onClick:function(){var e=y.slice(-1),n=Object(h.a)(e,1)[0];t.undo(n),b(t.entries()),v(H[n]),m(!0),w((function(e){return e.slice(0,-1)})),A(null)},disabled:0===y.length,children:"Undo"})]}),null!==S&&Object(r.jsxs)("div",{children:["Final Reward: ",S]})]})]})})}),_e=n(388),Ne=(n(431),function(){var e,t=new URLSearchParams(Object(u.g)().search),n=Object(a.useState)((function(){return t.get("agent")||"random"})),c=Object(h.a)(n,2),i=c[0],o=c[1],s=Object(a.useState)(null),l=Object(h.a)(s,2),b=l[0],d=l[1],j=Object(a.useState)(!0),f=Object(h.a)(j,2),v=f[0],O=f[1],p=Object(a.useState)(null!==(e=null===b||void 0===b?void 0:b.entries())&&void 0!==e?e:[]),x=Object(h.a)(p,2),m=x[0],g=x[1],k=Object(a.useState)(null),y=Object(h.a)(k,2),w=y[0],_=y[1],N=Object(a.useState)(!1),M=Object(h.a)(N,2),C=M[0],L=M[1],X=Object(a.useState)(!1),I=Object(h.a)(X,2),R=I[0],F=I[1],E=Object(a.useState)(null),B=Object(h.a)(E,2),T=B[0],z=B[1],J=Object(a.useState)(null),V=Object(h.a)(J,2),G=V[0],U=V[1],P=Object(a.useRef)(null);console.log("errorMessage: ".concat(T)),Object(a.useEffect)((function(){return function(){return clearInterval(P.current)}}),[]),Object(a.useEffect)((function(){return q(i)}),[i]);var Y=function(){var e=b.step();O(!1),g(e.entries),_(e.action),e.done&&U(e.reward)},D=Object(a.useCallback)((function(){b&&(b.reset(),O(!0),g(b.entries()),_(null),U(null))}),[b]);Object(a.useEffect)(D,[D]);var q=function(){var e=Object(A.a)(S.a.mark((function e(t){var n,r;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="trained"===e.t0?3:(e.t0,20);break;case 3:return F(!0),e.prev=4,z(null),e.next=8,de("model/model.json");case 8:n=e.sent,d(n),e.next=16;break;case 12:e.prev=12,e.t1=e.catch(4),z(e.t1.message),o("random");case 16:return e.prev=16,F(!1),e.finish(16);case 19:return e.abrupt("break",23);case 20:return r=new se,d(r),e.abrupt("break",23);case 23:case"end":return e.stop()}}),e,null,[[4,12,16,19]])})));return function(t){return e.apply(this,arguments)}}();return Object(r.jsxs)("div",{className:"agent-play-content",children:[Object(r.jsxs)("div",{className:"board-wrapper",children:[Object(r.jsx)("div",{className:"board-controls-above",children:Object(r.jsxs)("select",{value:i,onChange:function(e){return o(e.target.value)},disabled:C||R,children:[Object(r.jsx)("option",{value:"random",children:"Random Agent"}),Object(r.jsx)("option",{value:"trained",children:"Trained Agent"})]})}),Object(r.jsx)(ye,{resetBoard:v,entries:m,action:w,interactive:!1}),Object(r.jsxs)("div",{className:"board-controls-below",children:[Object(r.jsxs)("div",{children:[Object(r.jsx)("button",{type:"button",disabled:null===b||b.done||C,onClick:Y,children:"Step"}),C?Object(r.jsx)("button",{type:"button",onClick:function(){clearInterval(P.current),L(!1)},children:"Stop"}):Object(r.jsx)("button",{type:"button",disabled:null===b||b.done,onClick:function(){L(!0),Y(),P.current=setInterval((function(){b.done?(clearInterval(P.current),L(!1)):Y()}),1e3)},children:"Run"}),Object(r.jsx)("button",{type:"button",disabled:null===b||C,onClick:D,children:"Reset"})]}),null!==G&&Object(r.jsxs)("div",{children:["Final Reward: ",G]})]})]}),T&&Object(r.jsx)("div",{className:"alert-wrapper",children:Object(r.jsx)(_e.a,{transition:!1,variant:"danger",dismissible:!0,onClose:function(){return z(null)},children:T})})]})}),Se=n(386),Ae=n(380),Me=function(e){var t=Object(a.useRef)(null);t.current=e;return function(){if(t.current)return t.current.apply(t,arguments)}},Ce=(n(507),function(){var e=Object(a.useState)("endCondition1"),t=Object(h.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(!1),o=Object(h.a)(i,2),s=o[0],u=o[1],l=Object(a.useState)(0),b=Object(h.a)(l,2),d=b[0],j=b[1],f=Object(a.useState)(!1),v=Object(h.a)(f,2),O=v[0],p=v[1],x=Object(a.useState)(null),m=Object(h.a)(x,2),g=m[0],k=m[1],y=Object(a.useState)(!1),w=Object(h.a)(y,2),_=w[0],N=w[1],M=Object(a.useState)(!1),C=Object(h.a)(M,2),L=C[0],X=C[1],I=Object(a.useState)(!1),R=Object(h.a)(I,2),E=R[0],B=R[1],T=Object(a.useState)([]),z=Object(h.a)(T,2),J=z[0],V=z[1],G=Object(a.useRef)(),U=Object(a.useRef)([[],[]]),P=function(){var e=Object(a.useState)(0),t=Object(h.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(0),i=Object(h.a)(c,2),o=i[0],s=i[1];return[o,function(){var e=performance.now();s(e-n)},function(){r(performance.now()),s(0)}]}(),Y=Object(h.a)(P,3),D=Y[0],q=Y[1],H=Y[2],K=function(){var e=Object(a.useState)(0),t=Object(h.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(0),i=Object(h.a)(c,2),o=i[0],s=i[1],u=Object(a.useState)(0),l=Object(h.a)(u,2),b=l[0],d=l[1];return[b,function(){var e=o+1;s(e);var t=performance.now(),a=t-n;a>=1e3&&(d(1e3*e/a),r(t),s(0))},function(){r(performance.now()),s(0),d(0)}]}(),Q=Object(h.a)(K,3),W=Q[0],Z=Q[1],$=Q[2],ee=Me((function(e,t){var r;switch(n){case"endCondition0":r=function(e){return new ue(e)}(t);break;case"endCondition1":default:r=be(e,0);break;case"endCondition2":r=be(e,1)}for(var a=[];!r.done;){var c=r.step().actionIndex;a.push(c)}console.log("agentActions: ".concat(JSON.stringify(a))),j(1),B(!0),V(r.entries())})),te=Me((function(e){j(2)})),ne=Me((function(e){k(e),q(),Z()})),re=Me((function(){return O}));Object(a.useEffect)((function(){if(g&&g.finalRewardMA!==Number.NEGATIVE_INFINITY){X(!0);var e=g.episode,t=Object(h.a)(U.current,2),n=t[0],r=t[1];n.push({x:e,y:g.finalRewardMA}),r.push({x:e,y:g.bestFinalRewardMA}),_&&function(){var e={values:U.current,series:["Last","Best"]};Ae.render.linechart(G.current,e,{zoomToFit:!0,height:300,xLabel:"Episode",yLabel:"Final Reward (moving average)",seriesColors:["blue","red"]})}()}}),[g,_]);var ae=function(){var e=Object(A.a)(S.a.mark((function e(){var t;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!s){e.next=3;break}return e.abrupt("return");case 3:return u(!0),j(0),p(!1),H(),$(),N(!1),U.current=[[],[]],X(!1),B(!1),V([]),t={trainingSuccess:ee,trainingFailure:te,progress:ne,checkCancelled:re},e.next=16,je(n,t);case 16:$(),N(!0);case 18:return e.prev=18,u(!1),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[0,,18,21]])})));return function(){return e.apply(this,arguments)}}();return Object(r.jsx)("div",{className:"training-content",children:Object(r.jsxs)("div",{className:"training-content-inner",children:[Object(r.jsx)("div",{className:"training-warning",children:"NOTE: currently, training doesn't always work! I aim to make it more reliable."}),Object(r.jsxs)("div",{children:["Stop training when:",Object(r.jsxs)("select",{value:n,onChange:function(e){return c(e.target.value)},disabled:s,children:[Object(r.jsx)("option",{value:"endCondition0",children:"First solution is found"}),Object(r.jsx)("option",{value:"endCondition1",children:"Greedy policy solves puzzle"}),Object(r.jsx)("option",{value:"endCondition2",children:"Greedy policy solves puzzle for all first moves"})]})]}),Object(r.jsxs)("div",{className:"training-controls",children:[Object(r.jsxs)("div",{className:"training-controls-left",children:[s?Object(r.jsx)("button",{onClick:function(){p(!0),$(),N(!0)},children:"Cancel"}):Object(r.jsx)("button",{onClick:ae,children:"Train"}),g&&(_?Object(r.jsx)("button",{disabled:!L,onClick:function(){N(!1)},children:"Hide Chart"}):Object(r.jsx)("button",{disabled:!L,onClick:function(){N(!0)},children:"Show Chart"}))]}),Object(r.jsx)("div",{className:"training-controls-right",children:g&&Object(r.jsx)("div",{className:"training-timer",children:F(D)})})]}),g&&Object(r.jsx)(Se.a,{className:function(){switch(d){case 0:default:return"";case 1:return"bg-success";case 2:return"bg-danger"}}(),size:"sm",children:Object(r.jsxs)("tbody",{children:[Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{className:"training-stats-label",children:"Episode"}),Object(r.jsx)("td",{className:"training-stats-value",children:g.episode})]}),Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{className:"training-stats-label",children:"Episodes per second"}),Object(r.jsx)("td",{className:"training-stats-value",children:W.toFixed(2)})]}),Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{className:"training-stats-label",children:"\u03b5"}),Object(r.jsx)("td",{className:"training-stats-value",children:g.epsilon.toFixed(5)})]}),Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{className:"training-stats-label",children:"Last Final Reward"}),Object(r.jsx)("td",{className:"training-stats-value",children:g.finalReward})]}),Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{className:"training-stats-label",children:"Best Final Reward"}),Object(r.jsx)("td",{className:"training-stats-value",children:g.bestFinalReward})]}),Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{className:"training-stats-label",children:"Last Final Reward (MA)"}),Object(r.jsx)("td",{className:"training-stats-value",children:g.finalRewardMA.toFixed(3)})]}),Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{className:"training-stats-label",children:"Best Final Reward (MA)"}),Object(r.jsx)("td",{className:"training-stats-value",children:g.bestFinalRewardMA.toFixed(3)})]})]})}),_&&Object(r.jsx)("div",{ref:G,className:"training-stats-chart"}),E&&Object(r.jsx)(ye,{resetBoard:!1,entries:J,interactive:!1})]})})}),Le=n(387),Xe=(n(508),function(){return Object(r.jsxs)("div",{className:"version",children:["version: ",Le.a]})}),Ie=(n(509),function(){return Object(r.jsx)(s.a,{children:Object(r.jsxs)("div",{className:"app-layout",children:[Object(r.jsx)(f,{}),Object(r.jsx)("div",{className:"app-layout-content",children:Object(r.jsxs)(u.d,{children:[Object(r.jsx)(u.b,{path:b,children:Object(r.jsx)(we,{})}),Object(r.jsx)(u.b,{path:d,children:Object(r.jsx)(Ne,{})}),Object(r.jsx)(u.b,{path:j,children:Object(r.jsx)(Ce,{})}),Object(r.jsx)(u.b,{path:l,children:Object(r.jsx)(u.a,{to:d})})]})}),Object(r.jsx)(Xe,{})]})})}),Re=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,531)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};o.a.render(Object(r.jsx)(c.a.StrictMode,{children:Object(r.jsx)(Ie,{})}),document.getElementById("root")),Re()}},[[511,1,2]]]);
//# sourceMappingURL=main.ac1c7a9c.chunk.js.map